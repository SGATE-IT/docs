# 回调通知

## 功能简述

- SGate 提供了订单支付/退款完成的通知回调，会请求对应的 Client 的接收通知 URL
- 商户需提供接收 `GET` 请求的 URL，SGate 会在**成功完成支付交易**或**成功完成退款**后，向商户提供的 URL 发送回调通知。其中 SGate 会在 URL 上附加以下参数：

   | **参数** | **类型** | **描述**                                                 | **示例**                         |
   | -------- | -------- | -------------------------------------------------------- | -------------------------------- |
   | _orderId | string   | 订单 ID                                                  | "M000001T2022101023455774363043" |
   | _type    | string   | 回调类型：<br> payment：完成支付 <br> refund：完成退款 | "payment"                        |

  * 示例：`https://merchant.com/Notification?_orderId=M000001T2022101023455774363043&_type=payment`

## 流程说明

![img](/images/payinApi_zh/callback-notification.svg)

1. 商户调用 SGate “创建订单“ 或 "发起退款" 接口创建交易
2. SGate 返回交易创建成功
3. SGate 交易处理成功
4. SGate 向商户提供的 URL 发送回调通知，通知商户交易成功
5. 商户调用 SGate 交易对应的查询接口，进行状态确认
6. SGate 返回商户查询的交易状态
7. 商户确认交易状态无误后，返回回调通知，其中 body 为：`COMPLETED::{ORDER_ID}`
   * `{ORDER_ID}`：回调通知的订单 ID
   * 示例：`COMPLETED::M448726T2022123112531745487632`

## 回调通知规则

- 如果商户没有提供接收回调通知的 URL，则不会触发回调通知功能
- 通知回调如果没有被正确响应，则会多次请求，规则如下：
  - 如果商户未响应回调通知，则 SGate 每隔 5 秒重试 3 次
  - 如果商户回调通知返回错误，则 SGate 每隔 15 分钟重试 1 次